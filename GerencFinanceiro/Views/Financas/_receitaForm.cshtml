@model GerencFinanceiro.Models.Financas

<div class="modal-header">
    <a href="#" class="close" data-dismiss="modal">×</a>
    <h3 id="title" class="modal-title">@((Model.ItemId == 0) ? "Adicionar Receita" : "Editar Receita")</h3>
</div>
<div class="modal-body" id="receitaFormModelDiv">
    <form id="receitaForm" asp-controller="Financa" asp-action="Create" method="post" class="form-group">
        <input type="hidden" id="ItemId" asp-for="ItemId" name="ItemId" value="@Model.ItemId" />

        <div class="form-group">
            <label for="ItemNome">Receita</label>
            <input class="form-control" id="ItemNome" asp-for="ItemNome" name="ItemNome" type="text" value="@Model.ItemNome" placeholder="Informe o nome da finança" />
        </div>

        <div class="form-group">
            <label for="Valor">Valor</label>
            <input class="form-control" id="Valor" asp-for="Valor" name="Valor" type="text" value="@Model.Valor.ToString("F2")" placeholder="Informe o valor da finança" />
        </div>

        <div class="form-group">
            <label for="Date">Data</label>
            <input class="form-control" id="Date" asp-for="Date" name="Date" type="date" value="@Model.Date.ToString("yyyy-MM-dd")" />
        </div>

        <!-- Dropdown de Categorias -->
        <div class="form-group">
            <label for="Categoria">Categoria</label>
            <select class="form-control" id="Categoria" asp-for="Categoria" name="Categoria">
                <option value="">Selecione uma categoria</option> <!-- Placeholder inicial -->
            </select>
        </div>

        <div class="form-group">
            <input class="form-control" id="IsReceita" name="IsReceitaCheck" type="hidden" value="true" />
            <input type="hidden" id="IsReceitaValue" name="IsReceita" value="true"/>
        </div>

        <button type="submit" id="btnSubmit" class="btn btn-primary">Salvar</button>
    </form>
</div>

<script>
    // Populando o dropdown de categorias via AJAX
    $(document).ready(function () {
        $.ajax({
            url: '/Financas/GetCategoriasReceitas',
            method: 'GET',
            success: function (data) {
                console.log(data); // Verifica a estrutura dos dados no console

                // Verifica se 'data' é um objeto
                if (typeof data === 'object') {
                    var categoriaDropdown = $('#Categoria');
                    categoriaDropdown.empty(); // Limpa as opções anteriores
                    categoriaDropdown.append('<option value="">Selecione uma categoria</option>'); // Placeholder

                    // Itera sobre as chaves do objeto
                    Object.keys(data).forEach(function (categoria) {
                        categoriaDropdown.append('<option value="' + categoria + '">' + categoria + '</option>');
                    });
                } else {
                    console.error("Os dados recebidos não são um objeto:", data);
                }
            },
            error: function (xhr, status, error) {
                console.error("Erro ao buscar categorias: " + error);
            }
        });

        // Sincroniza o campo hidden de receita com o checkbox
        document.getElementById("IsReceita").addEventListener("change", function () {
            document.getElementById("IsReceitaValue").value = "true";
        });
    });
</script>
